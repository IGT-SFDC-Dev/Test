<apex:page controller="BMCServiceDesk.RequestDefController" showHeader="false"
    sidebar="false" id="thePage" contentType="{!contetnTypeForIE}"
    standardStylesheets="true">
    <c:CommonIncludes />
    <script type="text/javascript"
        src="{!$Resource.SDEFExtJS}/ex/ux/CheckColumn.js"></script>
    <apex:includeScript value="{!$Resource.BMCServiceDesk__SDEFCommonJS}/itemselector.js"/>
    <script type="text/javascript" src="{!$Resource.SDEFCommonJS}/Vtabpanel.js"></script>
    <link rel="Stylesheet" type="text/css" href="{!$Resource.SDEFStyles}/Knowledge.css" />
    
    <apex:includeScript value="{!$Resource.BMCServiceDesk__SDEFCommonJS}/JSCommon.js"
        id="JSCommon-js" />
    <link rel="stylesheet" type="text/css"
        href="{!$Resource.SDEFExtJS}/ex/ux/css/Spinner.css" />
    <apex:includeScript value="{!$Resource.BMCServiceDesk__SDEFExtJS}/ex/ux/Spinner.js" />
    <apex:includeScript value="{!$Resource.BMCServiceDesk__SDEFExtJS}/ex/ux/SpinnerField.js" />
    <script type="text/javascript"
        src="{!$Resource.SDEFCommonJS}/ReqDefPage.js"></script>
	<style>
	.x-grid3-hd-16
		{
		color:#2E7DB3;
		}
	</style>
    <script>
       
            
       Ext.ns("RequestDefPage");
            RequestDefPage.Labels = {
            PM_PageLoad: '{!JSENCODE($Label.PM_PageLoad)}',
            PM_netwokLatency: '{!JSENCODE($Label.PM_netwokLatency)}'
            }
            
             var stime = '{!serverstarttime}';
             var etime = '{!serverendtime}';
             var data = '';
             data += '{!JSENCODE($Label.PM_servertime)}';
             if(etime - stime == 0){
                data += 0;
             }
           var labelSavedSuccessfully = '{!JSENCODE($Label.SavedSuccessfully)}',            
            labelDelete = '{!JSENCODE($Label.Delete)}',
            labelSrch = '{!JSENCODE($Label.search)}',
            labelNoRecord = '{!JSENCODE($Label.MsgNoRecordFoundSearchPage)}',
            labelQuestion = '{!JSENCODE($Label.QuestionTitleSearchPage)}',
            labelWarning = '{!JSENCODE($Label.WarningTitleSearchPage)}',
            labelError = '{!JSENCODE($Label.ErrorTitleSearchPage)}',
            labelInfo = '{!JSENCODE($Label.InformationTitleSearchPage)}',
            labelMinChar = '{!JSENCODE($Label.validateMinimumCharsSearchPage)}',
            labelNew = '{!JSENCODE($Label.New)}',
            labelSave = '{!JSENCODE($Label.Save)}',
            labelOK = '{!JSENCODE($Label.OK)}',
            labelCancel = '{!JSENCODE($Label.Cancel)}',
            labelCopy = '{!JSENCODE($Label.Copy)}',
            labelReset = '{!JSENCODE($Label.Reset)}', 
            labelRefresh = '{!JSENCODE($Label.Refresh)}',           
            labelPreviousRecord = '{!JSENCODE($Label.PreviousRecord)}',
            labelInactive ='{!JSENCODE($ObjectType.SRM_RequestDefinition__c.fields.inactive__c.label)}',
            labelNextRecord = '{!JSENCODE($Label.NextRecord)}',
			labelPrevious = '{!JSENCODE($Label.PreviousPage)}',
			labelNext = '{!JSENCODE($Label.NextPage)}',
            AvailableAccounts = '{!JSENCODE($Label.AvailableAccounts)}',
            SelectedAccounts = '{!JSENCODE($Label.SelectedAccounts)}',
            SelectedProfile = '{!JSENCODE($Label.SelectedProfile)}',
            AvailableProfile = '{!JSENCODE($Label.AvailableProfile)}',
            targetInDays = '{!reqDefBean.targetInDays}',
            targetInHours = '{!reqDefBean.targetInHours}',
            LabelOptions = '{!JSENCODE($Label.Options)}',
            labelDeleteConfirm = '{!JSENCODE($Label.DeleteConfirmMessage)}',
            reqDefWindowHeader = '{!JSENCODE($ObjectType.SRM_RequestDefinition__c.label)}',
            fulfillmentInputWindowHeader = '{!JSENCODE($Label.fulfillmentInput)}',
            taskTemplateExecutionOrder = '{!JSENCODE($Label.taskTemplateExecutionOrder)}',
            close = '{!JSENCODE($Label.Close)}',
            TextAreaOverflow = '{!JSENCODE($Label.TextAreaOverflow)}',
            newTitle;
            var Description = '{!JSENCODE($ObjectType.SRM_RequestDefinition__c.fields.description__c.label)}';
            var infixCondition ='';
            var postfixCondition =''
            
            
        
            var isRequestDefCreatable = '{!reqDefBean.isRequestDefCreatable}';
            var isrequestDefUpdateble = '{!reqDefBean.isrequestDefUpdateble}';
            var isRequestDefDeletable = '{!reqDefBean.isRequestDefDeletable}';  
			
			
			
            var dateValue = '{!JSENCODE(reqDefBean.filterClauseDate)}';
            var dateClause = escape('(serviceType__c != \'Offering\') And (end_date__c = null or end_date__c >=' + dateValue + ')');
            
            var isInActive = {!reqDefBean.isInActive};

            function getPreFirstBtn(){
                return !{!IF(paginator.hasPrevious,'true','false')};
            }
            function getNextLastBtn(){
                return !{!IF(paginator.hasNext,'true','false')};
            }
            function getIsDirect(){
                return '{!JSENCODE($CurrentPage.parameters.isDirect)}';
            }
            function getReqDefID(){
                return '{!reqDefBean.reqDefObj.Id}';
            }
            function getWID(){
                return '{!JSENCODE($CurrentPage.parameters.wid)}';
            }           
            function getImageID(attachmentId){
             document.getElementById('{!$Component.ReqDefForm.Image_Id}').src='/servlet/servlet.FileDownload?file='+attachmentId;
                 setReqDefDoc(attachmentId);
            }
            function getSDFStylesResPath(){
            var resPath = '{!$Resource.SDEFStyles}';
            return resPath;  
            }
            function getDaysTargetHiddenEle(){            
            return document.getElementById('{!$Component.ReqDefForm.targetInDays}');
            }
            function getHoursTargetHiddenEle(){            
            return document.getElementById('{!$Component.ReqDefForm.targetInHours}');
            }
            function getRefDefDescriptionEle(){
            return document.getElementById('{!$Component.ReqDefForm.ReqDef_Description}');
            }
            function setCatData(id, name, catUrgency) {
            document.getElementById('{!$Component.ReqDefForm.Category__c_id_name}').value = name;
            document.getElementById('{!$Component.ReqDefForm.Category__c_id_id}').value = id;
            document.getElementById('{!$Component.ReqDefForm.Category__c_id_fkurgency__c}').value = catUrgency;
            }
            function openImagePopup(){
                var folder = '{!folderId}';
                if(document.getElementById('radioCom').checked == true){
                    openPopupWithTitle('DocPage?folderId='+ folder ,'','Add Image',Ext.isIE7 ?160 : Ext.isIE8 ? 147:150,450,false);
                }else if(document.getElementById('radioSF').checked = true){
                    var percetage = encodeURIComponent('%');
                    var clause = encodeURIComponent('ContentType like \'image'+percetage+'\' AND FolderId = \''+ folder+'\'');
                    if(!inProgress){
                        openPopup('SearchPage?popupId=Document&isLookup=true&filterClause=' + clause ,setReqDefDoc);
                    }
                }
            }
            function updateTitle(){
                if(errormsg == '{!JSENCODE($Label.SavedSuccessfully)}'){
                    var wid = getWID();
                    window.parent.changeTitle(wid,newTitle,newTitle);
                    window.parent.refreshList();
                }
            }
            function assignApexErrorMessage(){
            
                var elem = document.getElementById('apexMessageErrorPanelDiv');
                if(elem != null && elem.firstChild != null){
                    var ulList = elem.firstChild;
                    var msgvalue = ulList.firstChild.innerHTML;
                    Ext.MessageBox.show({ msg: msgvalue, buttons: Ext.MessageBox.OK});
                }
            }
            
            function resetEntitlementData(){
                
                accLeftStore.removeAll();
                accRightStore.removeAll();
                profileLeftStore.removeAll();
                profileRightStore.removeAll();
                
                accLeftStore.loadData(accLeftStoreData);
                accRightStore.loadData(accRightStoreData);
                profileLeftStore.loadData(profileLeftStoreData);
                profileRightStore.loadData(profileRightStoreData);
         
        }
        
        //Data for request fulfillment
        //Process labels
         var labelProcessNameHeader = '{!JSENCODE($Label.FulfillmentProcessName)}',
             labelProcessDescHeader = '{!JSENCODE($ObjectType.SYSTemplate__c.fields.description__c.label)}',
             labelAdd='{!JSENCODE($Label.Add)}',
             labelProcessTab = '{!JSENCODE($Label.Template)}';
             
         
         //Input labels
         var labelInputPromptHeader = '{!JSENCODE($Label.PromptQuestionHeader)}',
             labelResponseTypeHeader = '{!JSENCODE($ObjectType.SRM_FulfillmentInputs__c.fields.ResponseType__c.label)}', 
             labelRequiredHeader = '{!JSENCODE($ObjectType.SRM_FulfillmentInputs__c.fields.Required__c.label)}',
             labelHiddenHeader = '{!JSENCODE($ObjectType.SRM_FulfillmentInputs__c.fields.Hidden__c.label)}',
             labelEdit = '{!JSENCODE($Label.CMDBEdit)}',
             labelInputDeleteConfirmMsg = '{!JSENCODE($Label.InputDeleteConfirmMessage)}',
             labelProcessDeleteConfirmMsg = '{!JSENCODE($Label.ProcessDeleteConfirmMessage)}',
             labelInputTab = '{!JSENCODE($Label.InputTabTitle)}';
         
         //Mapping labels
         var labelRequestInputCaption = '{!JSENCODE($Label.RequestInputSource)}',
             labelProcessVariableCaption = '{!JSENCODE($Label.ProcessVariableTarget)}',
             labelRequestInputHeader = '{!JSENCODE($Label.RequestInputPromptQuestionHeader)}',
             labelProcessVariableHeader = '{!JSENCODE($Label.CIExpField)}',
             labelConcatenateSelection = '{!JSENCODE($Label.ConcatenateInputSelections)}',
             labelMappingTab = '{!JSENCODE($Label.MappingTabTitle)}';
        
        
        //Error message labels
        var labelNone='{!JSENCODE($Label.None)}',
            labelSelectInputError='{!JSENCODE($Label.PleaseSelectRequestInput)}',
            labelSelectProcessVarError='{!JSENCODE($Label.PleaseSelectProcessVariable)}';
        
        
         var  reDefId = '{!reqDefBean.reqDefObj.id}';
         var wid2 = '{!JSENCODE($CurrentPage.parameters.wid)}';
         var processFilterClause = escape('(templateFor__c=\'Change Request\' or templateFor__c=\'Task\')');
         
         var isInputOrderChanged = false;
         var reqInputOrderCompId = '{!$Component.ReqDefForm.reqInputOrder}';
         var linkProcessTemplate="/apex/SearchPage?popupId=ProcessTemplate&view=list&pgheight=656";
         function getSDFStylesResPath(){
             var resPath = '{!$Resource.SDEFStyles}';
             return resPath;
         }
          
        /*
        Check user premissions           
        */
        var isProcessCreateable = '{!reqDefBean.isProcessCreateable}';
        var isProcessDeleteable = '{!reqDefBean.isProcessDeleteable}';
        var isInputCreateable = '{!reqDefBean.isInputCreateable}';
        var isInputUpdateable = '{!reqDefBean.isInputUpdateable}';
        var isInputDeleteable = '{!reqDefBean.isInputDeleteable}';
        var isMappingCreateable = '{!reqDefBean.isMappingCreateable}';
        var isMappingDeleteable = '{!reqDefBean.isMappingDeleteable}';
        var dispTypeTxt = '{!reqDefBean.dispTypeTxt}', dispTypeTxtArea='{!reqDefBean.dispTypeTxtArea}', dispTypeBoolean='{!reqDefBean.dispTypeBoolean}',
            dispTypeInt='{!reqDefBean.dispTypeInt}', dispTypeDouble='{!reqDefBean.dispTypeDouble}', dispTypeCurr='{!reqDefBean.dispTypeCurr}', 
            dispTypeDate='{!reqDefBean.dispTypeDate}',dispTypeDateTime='{!reqDefBean.dispTypeDateTime}', dispTypePicklist='{!reqDefBean.dispTypePicklist}', 
            dispTypeReference='{!reqDefBean.dispTypeReference}', refTypeImpact='{!reqDefBean.refTypeImpact}', refTypeCategory='{!reqDefBean.refTypeCategory}', refTypeUrgency='{!reqDefBean.refTypeUrgency}';
 
        
        function setBusiOffering(){
            var fkBusinessOffering = document.getElementById('{!$Component.thePage.ReqDefForm.BMC_BusinessService__c_id_fkbmc_baseelement__c__x_1}').value;
            if(fkBusinessOffering != null && fkBusinessOffering != ''){
                setServiceOffering(fkBusinessOffering);
            }
        }
        function setofferingClausePanelData()
        {
            isReqDefDeleted = {!isReqDefDeleted};
            errormsg = '{!JSENCODE(reqDefBean.messageString)}'; 
            OfferingClause = null;
            //var fkService = '{!JSENCODE(reqDefBean.reqDefObj.FKBusinessService__c)}';
            var fkService ='';
			if(document.getElementById('{!$Component.thePage.ReqDefForm.BMC_BusinessService__c_id_fkbmc_baseelement__c}')!=null
				&& document.getElementById('{!$Component.thePage.ReqDefForm.BMC_BusinessService__c_id_fkbmc_baseelement__c}')!=''
			)
			{
				fkService = document.getElementById('{!$Component.thePage.ReqDefForm.BMC_BusinessService__c_id_fkbmc_baseelement__c}').value;
			}
            var fkServiceField = '';
			if(document.getElementById('{!$Component.thePage.ReqDefForm.BMC_BusinessService__c_id_instance_name__c}')!=null
				&& document.getElementById('{!$Component.thePage.ReqDefForm.BMC_BusinessService__c_id_instance_name__c}')!=''
			){
				fkServiceField = document.getElementById('{!$Component.thePage.ReqDefForm.BMC_BusinessService__c_id_instance_name__c}').value; 
			}
            if(fkService != null && fkService != '' && fkServiceField != null && fkServiceField != ''){
                OfferingClause = escape('(serviceType__c = \'Offering\') And (FKBusinessService__c =\'' + fkService + '\')  And (end_date__c = null or end_date__c >=' + dateValue + ')');
            }else{
                OfferingClause = escape('(serviceType__c = \'Offering\') And (end_date__c = null or end_date__c >=' + dateValue + ')');
            }
        }
        
     </script>
    <link rel="stylesheet" type="text/css"
        href="{!$Resource.SDEFStyles}/CustomViews.css" />
    <link rel="stylesheet" type="text/css"
        href="{!$Resource.SDEFStyles}/ReqDefPage.css" />
    
    <apex:outputPanel id="mappingDataPanel">
        <script>
            //Array store for process comboBox on Mappings tab
            var processOptionData = [{!ProcessOptions}];

            //Array store for request input grid
            var questionData = [{!RequestPrompts}];
        </script>
    </apex:outputPanel>
    <!-- Data for Request Fulfillment Tab and List Views-->
    <apex:outputPanel id="processTemplateStore">
        <script>
           /*
             Request Process/template data setup, populate data store for process grid         
           */
        
            var processData;            
            var disableReorderBTN;
            function setProcessData() {
              	disableReorderBTN ='{!disableReorderBTN}';
                processData = [{!ProcessTemplates}];
                setProcessDataStore(processData);
                setProcessOptionStore(processOptionData);
            } 
        </script>
     </apex:outputPanel>
     <apex:outputPanel id="requestInputStore">
        <script>
            /*
                Request input data setup,  populate data store for request input grid         
            */
            var inputData;
            function setInputData() {
                inputData = [{!processInputs}];
                setInputDataStore(inputData);
                setQuestionDataStore(questionData);
            }
        </script>
     </apex:outputPanel>
    
     <apex:outputPanel id="processVarStore">
        <script>
            var processVarData = [];
           
           
           function setProcessVarData() {
                processVarData = [{!reqDefBean.processVarData}]; 
                setProcessVarDataStore(processVarData);
            } 
        </script>
        
     </apex:outputPanel>

      <apex:outputPanel id="inputMappingStore">
        <script> 
            var mappingData = [];
            function setInputMappingData() {
                mappingData = [{!inputMappings}];
                setInputMappingDataStore(mappingData);
            }
            
        </script>
        
     </apex:outputPanel>
     
     <apex:outputPanel id="offeringClausePanel">
        <script>
            isReqDefDeleted = {!isReqDefDeleted};
            errormsg = '{!JSENCODE(reqDefBean.messageString)}'; 
            var OfferingClause = null;
            var fkService = '{!JSENCODE(reqDefBean.reqDefObj.FKBusinessService__c)}';
            var fkServiceField ='';
			if(document.getElementById('{!$Component.thePage.ReqDefForm.BMC_BusinessService__c_id_instance_name__c}')!=null)
			{
				fkServiceField=document.getElementById('{!$Component.thePage.ReqDefForm.BMC_BusinessService__c_id_instance_name__c}').value; 
			}
            if((fkService != null && fkService != '') || (fkServiceField != null && fkServiceField != '') ){
                OfferingClause = escape('(serviceType__c = \'Offering\') And (FKBusinessService__c =\'' + fkService + '\')  And (end_date__c = null or end_date__c >=' + dateValue + ')');
            }else{
                OfferingClause = escape('(serviceType__c = \'Offering\') And (end_date__c = null or end_date__c >=' + dateValue + ')');
            }
        </script>
        
     </apex:outputPanel>
    <!-- .End of Data for Request Fulfillment Tab and List Views-->
    <apex:form id="ReqDefForm">
        <c:TabOutComponent ></c:TabOutComponent>
        <c:ValidationComponent errorMsgList="{!reqDefBean.messageString}"
            id="validationComponent"></c:ValidationComponent>
        <apex:actionFunction action="{!getSearchAccounts}"
            name="getSearchAccounts"
            rerender="EntitlementScript" oncomplete="loadLeftData();">
            <apex:param assignTo="{!searchString}" name="searchstring" value="" />
            <apex:param assignTo="{!accRightStoreData}" name="rightData" value="" />
        </apex:actionFunction>        
        <apex:actionFunction action="{!nextAccounts}" 
            name="nextAccounts"
            rerender="EntitlementScript" oncomplete="loadLeftData();">  
            <apex:param assignTo="{!accRightStoreData}" name="rightData" value="" />          
        </apex:actionFunction>
        <apex:actionFunction action="{!prevAccounts}"
            name="prevAccounts"
            rerender="EntitlementScript" oncomplete="loadLeftData();">            
            <apex:param assignTo="{!accRightStoreData}" name="rightData" value="" />
        </apex:actionFunction>
        <apex:actionFunction action="{!setSelectedBusinessService}"
            name="setBusinessService"
            rerender="BMC_BusinessService__c_id_instance_name__c,BMC_BusinessService__c_id_fkbmc_baseelement__c,offeringClausePanel,apexMessageErrorPanel" oncomplete="assignApexErrorMessage();">
            <apex:param assignTo="{!savedID}" name="savedID" value="" />
        </apex:actionFunction>
        <apex:actionFunction action="{!setSelectedServiceOffering}"
            name="setServiceOffering"
            rerender="BMC_BusinessService__c_id_instance_name__c__x_1, BMC_BusinessService__c_id_fkbmc_baseelement__c__x_1, CustomerPrice__c, DeliveryCost__c, RequestDefinition__c_id_StartDate__c, RequestDefinition__c_id_EndDate__c, CostOption1__c, CostOption2__c, PriceOption1__c, PriceOption2__c, BMC_BusinessService__c_id_instance_name__c, BMC_BusinessService__c_id_fkbmc_baseelement__c,apexMessageErrorPanel" oncomplete="assignApexErrorMessage();">
            <apex:param assignTo="{!savedID}" name="savedID" value="" />
        </apex:actionFunction>
        <apex:actionFunction action="{!setSelectedDoc}" name="setReqDefDoc"
            rerender="Image_Id" oncomplete="">
            <apex:param assignTo="{!savedID}" name="savedID" value="" />
        </apex:actionFunction>

        <apex:actionFunction name="save" action="{!save}"
            reRender="afterSavePanel,validationComponent,apexMessageErrorPanel, processTemplateStore, requestInputStore, inputMappingStore, mappingDataPanel, customerPriceCurrency,deliveryCostCurrency"
            onComplete="enablebtn();showError();setProcessData();updateProcessOptions();setInputData();setInputMappingData();updateTitle();assignApexErrorMessage();setBtnState();handleSave();">
            <apex:param assignTo="{!reqDefBean.reqDefObj.Inactive__c}"
                name="savedName" value="" />
        </apex:actionFunction>

        
        <apex:actionFunction name="deleteReqDefObj" action="{!deleteReqDef}" rerender="offeringClausePanel" oncomplete="closeWindow();"/>
        <apex:actionFunction name="resetReqDefObj" action="{!reset}" rerender="targetInDays, targetInHours, ReqDef_Title, ReqDef_Description, BMC_BusinessService__c_id_instance_name__c, BMC_BusinessService__c_id_fkbmc_baseelement__c, BMC_BusinessService__c_id_instance_name__c__x_1, 
                    BMC_BusinessService__c_id_fkbmc_baseelement__c__x_1, Category__c_id_name, Category__c_id_id, Category__c_id_fkurgency__c, CustomerPrice__c, PriceOption1__c, PriceOption2__c, DeliveryCost__c, 
                    CostOption1__c, CostOption2__c, RequestDefinition__c_id_StartDate__c, RequestDefinition__c_id_EndDate__c, 
                    Image_Id, RequestDefinition_Status, RequestDefinition_Online, OptionsTab, EntitlementScript, allAccount, allProfile,isApprovalReqd,
                    processTemplateStore, requestInputStore, processVarStore, inputMappingStore,mappingDataPanel, SRM_RequestDefinition_userInstructions__c, afterSavePanel, SYSTemplate__c_id_name, SYSTemplate__c_id_id,customerPriceCurrency,deliveryCostCurrency" 
                    oncomplete="setTurnaroundTime();resetEntitlementData();callToggleAccountSelector();callToggleProfileSelector();setProcessData();setInputData();setProcessVarData();setInputMappingData();resetProcessOption();">
        </apex:actionFunction>
        
        <apex:actionRegion >
        <apex:actionFunction name="previousReqDef" action="{!previous}" rerender="targetInDays, targetInHours, ReqDef_Title, ReqDef_Description, BMC_BusinessService__c_id_instance_name__c, BMC_BusinessService__c_id_fkbmc_baseelement__c, BMC_BusinessService__c_id_instance_name__c__x_1, 
                    BMC_BusinessService__c_id_fkbmc_baseelement__c__x_1, Category__c_id_name, Category__c_id_id, Category__c_id_fkurgency__c, CustomerPrice__c, PriceOption1__c, PriceOption2__c, DeliveryCost__c, 
                    CostOption1__c, CostOption2__c, RequestDefinition__c_id_StartDate__c, RequestDefinition__c_id_EndDate__c, 
                    Image_Id, RequestDefinition_Status, RequestDefinition_Online, OptionsTab, EntitlementScript, allAccount, allProfile,isApprovalReqd,
                    processTemplateStore, requestInputStore, processVarStore, inputMappingStore,mappingDataPanel, SRM_RequestDefinition_userInstructions__c, afterSavePanel, SYSTemplate__c_id_name, SYSTemplate__c_id_id,customerPriceCurrency,deliveryCostCurrency" 
                    oncomplete="setTurnaroundTime();resetEntitlementData();callToggleAccountSelector();callToggleProfileSelector();setProcessData();setInputData();setProcessVarData();setInputMappingData();resetProcessOption();window.parent.changeTitle(getWID(),newTitle,newTitle);handleSave();">
            <apex:param assignTo="{!reqDefBean.tempString}" name="idSetString" value=""/> 
        </apex:actionFunction>
        
        <apex:actionFunction name="nextReqDef" action="{!next}" rerender="targetInDays, targetInHours, ReqDef_Title, ReqDef_Description, BMC_BusinessService__c_id_instance_name__c, BMC_BusinessService__c_id_fkbmc_baseelement__c, BMC_BusinessService__c_id_instance_name__c__x_1, 
                    BMC_BusinessService__c_id_fkbmc_baseelement__c__x_1, Category__c_id_name, Category__c_id_id, Category__c_id_fkurgency__c, CustomerPrice__c, PriceOption1__c, PriceOption2__c, DeliveryCost__c, 
                    CostOption1__c, CostOption2__c, RequestDefinition__c_id_StartDate__c, RequestDefinition__c_id_EndDate__c, 
                    Image_Id, RequestDefinition_Status, RequestDefinition_Online, OptionsTab, EntitlementScript, allAccount, allProfile,isApprovalReqd,
                    processTemplateStore, requestInputStore, processVarStore, inputMappingStore,mappingDataPanel, SRM_RequestDefinition_userInstructions__c, afterSavePanel, SYSTemplate__c_id_name, SYSTemplate__c_id_id,customerPriceCurrency,deliveryCostCurrency" 
                    oncomplete="setTurnaroundTime();resetEntitlementData();callToggleAccountSelector();callToggleProfileSelector();setProcessData();setInputData();setProcessVarData();setInputMappingData();resetProcessOption();window.parent.changeTitle(getWID(),newTitle,newTitle);handleSave();">
            <apex:param assignTo="{!reqDefBean.tempString}" name="idSetString" value=""/> 
        </apex:actionFunction>
        </apex:actionRegion>
        <apex:actionFunction action="{!setServiceRequestTemplate}"
            name="setServiceRequestTemplate"
            rerender="SYSTemplate__c_id_name, SYSTemplate__c_id_id,apexMessageErrorPanel" oncomplete="assignApexErrorMessage();">
            <apex:param assignTo="{!savedID}" name="savedID" value="" />
        </apex:actionFunction>
        <apex:inputHidden id="targetInDays" value="{!reqDefBean.targetInDays}" />
        <apex:inputHidden id="targetInHours" value="{!reqDefBean.targetInHours}" />
        <!-- <apex:inputHidden id="cPriceInUSD" value="{!reqDefBean.cPriceInUSD}" />
        <apex:inputHidden id="dPriceInUSD" value="{!reqDefBean.dPriceInUSD}" />  -->

        <div id="capsule" class="clsCapsule">
        <table cellpadding="0" cellspacing="0" class="clsMainTable" >

            <!-- Button toolbar row -->
            <tr class="clsRowGreyBg">
                <td colspan="2">
                <div id="btnToolbar"></div>
                </td>
            </tr>

            <tr>
                <!-- <div id='ReqDef_TabPanel' style='border: 1px solid #999999;'>  -->
            
                <apex:outputPanel id="tablePanel">
                    <table cellpadding="0" cellspacing="0" class="clsTable">
                        <tr>
                            <td colspan="3">
                            <div class="div15pxVspacing" />
                            </td>
                        </tr>
                        <tr>
                            <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__serviceRequestTitle__c.label}" />
                            <span class="clsRequiredBlack">&nbsp;*</span></td>
                            <td class="clsInputTextBoxTD clsLeftPadTD"><apex:inputText value="{!reqDefBean.reqDefObj.BMCServiceDesk__serviceRequestTitle__c}"
                                disabled="false" id="ReqDef_Title" StyleClass="clsInputTextBox"
                                tabindex="1" /></td>
                        </tr>
                        <tr>
                            <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__Description__c.label}" /></td>
                            <td class="clsLeftPadTD">
                            <apex:inputTextArea value="{!reqDefBean.reqDefObj.BMCServiceDesk__Description__c}" disabled="false"
                                id="ReqDef_Description"
                                StyleClass="clsInputTextFieldRel" tabindex="2" /></td>
                            <td class="TextboxPopupIconTD" style="width: 22px;">                            
                            <div class="TextboxPopupIconDiv">
                                <input type="button"
                                class="TextboxPopupIcon" style="cursor:pointer;"
                                onclick="showTextEditor('{!$Component.ReqDefForm.ReqDef_Description}', '{!JSENCODE($ObjectType.SRM_RequestDefinition__c.fields.Description__c.label)}',32000, labelOK , labelCancel);" />                                                               
                            </div>
                            </td>                            	
                            <td class="clsPadding5TD">
                            	<apex:inputHidden id="ReqDef_Description_RichText" value="{!reqDefBean.reqDefObj.BMCServiceDesk__Description_Rich_Text__c}"/>
                          		<input type="button"
                                    class="changeBtnCls" style="cursor:pointer;height: 19px;"
                                    title="{!$Label.Rich_Text_Description}" value="{!$Label.Rich_Text_Description}"
                                    onclick="if(!inProgress){
                                    	var winWidth = 0;
                                    	if(window.innerWidth == 'undefined' || window.innerWidth == undefined){
											winWidth = document.documentElement.offsetWidth;
										}
										else
											winWidth = window.innerWidth;
										if(winWidth > 1000)
											winWidth = 930;
                                        if(recordID != ''){
                                            openPopupWithTitle('ReqDefDescription?id='+recordID ,setBusinessService, '{!JSENCODE($Label.Rich_Text_Description)}', 617, winWidth-24);
                                        }
                                        else{
                                            openPopupWithTitle('ReqDefDescription',setBusinessService, '{!JSENCODE($Label.Rich_Text_Description)}', 617, winWidth-24);
                                        }
                                        }" />
                            </td>
                        </tr>
                    </table>
                </apex:outputPanel>
                <table cellpadding="0" cellspacing="0">
                    <tr>
                        <td height="14"></td>
                    </tr>
                    <tr>
                        <td class="clsPadding5TD"><input type="button"
                            id="ReqDef_GeneralInfo" class="changeBtnCls"
                            title="{!$Label.SLM_General_Information}" value="{!$Label.SLM_General_Information}"
                            onclick="displayActiveTab(this);" /></td>
                        <td class="clsPadding5TD"><input type="button"
                            id="ReqDef_Fulfillment" class="changeBtnCls" title="{!$Label.Fulfillment}"
                            value="{!$Label.Fulfillment}" onclick="displayActiveTab(this);" /></td>
                        <td class="clsPadding5TD"><input type="button"
                            id="ReqDef_Entitlement" class="changeBtnCls" title="{!$Label.Entitlement}"
                            value="{!$Label.Entitlement}" 
                            onclick="displayActiveTab(this);" /></td>
                        <td class="clsPadding5TD"><input type="button"
                            id="ReqDef_Options" class="changeBtnCls" title="{!$Label.Options}"
                            value="{!$Label.Options}"
                            onclick="displayActiveTab(this);" /></td>
                    </tr>
                    <tr>
                        <td height="6"></td>
                    </tr>
                </table>
                
                <div id='ReqDef_GeneralInfoTab' class="clsGeneralInfoTab">
                <table width="659px" cellpadding="0" cellspacing="0">
                    <tr>
                        <td height="15"></td>
                    </tr>
                    <tr>
                        <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__FKBusinessService__c.label}" />
                        <span class="clsRequiredBlack">&nbsp;*</span></td>
                        <td>
                        <table cellpadding="0" cellspacing="0">
                            <tr>
                                <td class="clsInputTextBoxTD"><apex:inputText title="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__FKBusinessService__c.inlineHelpText}"
                                    id="BMC_BusinessService__c_id_instance_name__c"
                                    value="{!reqDefBean.businessServiceName}"
                                    styleClass="clsIdInputTextBox"
                                    onblur="showalldata(event,setofferingClausePanelData,dateClause);" />
                                    <apex:inputHidden id="BMC_BusinessService__c_id_fkbmc_baseelement__c" value="{!reqDefBean.reqDefObj.BMCServiceDesk__FKBusinessService__c}"/>
                                </td>
                                <td>
                                <div class="lookUpIconDiv"><input
                                    id="businessserviceLookup" type="button"
                                    onclick="if(!inProgress){openPopup('SearchPage?popupId=BMC_BusinessService&isLookup=true&filterClause=' + dateClause ,setBusinessService)}"
                                    class="lookupIconOn" /></div>
                                </td>
                            </tr>
                        </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__FKServiceOffering__c.label}" /><span
                            class="clsRequiredBlack">&nbsp;*</span></td>
                        <td>
                        <table cellpadding="0" cellspacing="0">
                            <tr>
                                <td class="clsInputTextBoxTD"><apex:inputText title="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__FKServiceOffering__c.inlineHelpText}"
                                    id="BMC_BusinessService__c_id_instance_name__c__x_1"
                                    value="{!reqDefBean.ServiceOfferingName}"
                                    styleClass="clsIdInputTextBox"
                                    onblur="showalldata(event,setBusiOffering,OfferingClause);" />
                                    <apex:inputHidden id="BMC_BusinessService__c_id_fkbmc_baseelement__c__x_1" value="{!reqDefBean.reqDefObj.BMCServiceDesk__FKServiceOffering__c}"/>
                                </td>
                                <td>
                                <div class="lookUpIconDiv"><input
                                    id="businessserviceLookup" type="button"
                                    onclick="if(!inProgress){setofferingClausePanelData();openPopup('SearchPage?popupId=BMC_BusinessService&isLookup=true&filterClause='+OfferingClause,setServiceOffering)}"
                                    class="lookupIconOn" /></div>
                                </td>
                            </tr>
                        </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__FKCategory__c.label}" /><span
                            class="clsRequiredBlack">&nbsp;*</span></td>
                        <td>
                        <table cellpadding="0" cellspacing="0">
                            <tr>
                                <td class="clsInputTextBoxTD"><apex:inputText title="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__FKCategory__c.inlineHelpText}"
                                    id="Category__c_id_name" value="{!reqDefBean.categoryName}"
                                    styleClass="clsIdInputTextBox" onBlur="showalldata(event,null,escape('inactive__c = false and AvailableForServiceCatalog__c=true'));" />
                                <apex:inputhidden id="Category__c_id_id"
                                    value="{!reqDefBean.reqDefObj.BMCServiceDesk__FKCategory__c}" /><apex:inputhidden id="Category__c_id_fkurgency__c" /></td>
                                <td>
                                <div class="lookUpIconDiv"><input type="button"
                                    id="RequestDefinitionLookup"
                                    onclick="if(!inProgress){openPopup('CategorySearchPage?isLookup=true&isSD=true&isRequestCatalog=true&categoryview=SR&filterClause='+ escape('inactive__c = false'),openCategoryLookup);}"
                                    class="lookupIconOn" /></div>
                                </td>
                            </tr>
                        </table>
                        </td>
                    </tr>
                    <!-- Service Request Template Lookup -->
                    <tr>
                        <td class="clsInputLabelTD"><apex:outputLabel value="{!$Label.bmcservicedesk__ServiceRequestTemplateLookupLabel}" /><span
                            class="clsRequiredBlack">&nbsp;*</span></td>
                        <td>
                        <table cellpadding="0" cellspacing="0">
                            <tr>
                                <td class="clsInputTextBoxTD"><apex:inputText title="{!$Label.bmcservicedesk__ServiceRequestTemplateLookupHelpText}"
                                    id="SYSTemplate__c_id_name" value="{!reqDefBean.serviceReqTemplateName}"
                                    styleClass="clsIdInputTextBox" onblur="showalldata(event,null,escape('(templateFor__c=\'Request Detail\')'));" />
                                <apex:inputhidden id="SYSTemplate__c_id_id"
                                    value="{!reqDefBean.serviceReqTemplateObj.BMCServiceDesk__FKTemplate__c}" /></td>
                                <td>
                                <div class="lookUpIconDiv"><input type="button"
                                    id="ServiceReqTemplateLookup"
                                    onclick="if(!inProgress){openPopup('SearchPage?popupId=Template&isLookup=true&filterClause='+escape('(templateFor__c=\'Request Detail\')'),setServiceRequestTemplate);}"
                                    class="lookupIconOn" /></div>
                                </td>
                            </tr>
                        </table>
                        </td> 
                    </tr>
                    <tr>
                        <td class="clsInputLabelTD clsInputfixedLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__CustomerPrice__c.label}" />
                        </td>
                        <td>
                        <table cellpadding="0" cellspacing="0" width="100%">
                            <tr>
                                <td class="clsInlineHelpTD" title="{!$ObjectType.SRM_RequestDefinition__c.fields.CustomerPrice__c.inlineHelpText}">
                                    <apex:inputfield styleClass="reqDefclsInputTextBox" value="{!reqDefBean.reqDefObj.BMCServiceDesk__CustomerPrice__c}" id="CustomerPrice__c" />
                                </td>
                                <td class="clsCurrencyTD">  
                                    <apex:outputLabel id="customerPriceCurrency" styleClass="reqDefclsInputLabelTD" value="{!currencyUsed} /" />
                                </td>
                                <td class="clsPrice1TD"><apex:inputfield styleClass="clsRequestDefSelectList"
                                    value="{!reqDefBean.reqDefObj.BMCServiceDesk__PriceOption1__c}"
                                    id="PriceOption1__c" /><apex:outputLabel value="/" /></td>
                                <td class="clsPrice2TD"><apex:inputfield styleClass="clsRequestDefSelectList"
                                    value="{!reqDefBean.reqDefObj.BMCServiceDesk__PriceOption2__c}"
                                    id="PriceOption2__c" /></td>
                            </tr>
                        </table>
                    </td>
                    </tr>
                    <tr>
                        <td class="clsInputLabelTD clsInputfixedLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__DeliveryCost__c.label}" />
                        </td>
                        <td>
                        <table cellpadding="0" cellspacing="0" width="100%">
                            <tr>
                                <td class="clsInlineHelpTD" title="{!$ObjectType.SRM_RequestDefinition__c.fields.DeliveryCost__c.inlineHelpText}">
                                    <apex:inputfield styleClass="reqDefclsInputTextBox" value="{!reqDefBean.reqDefObj.BMCServiceDesk__DeliveryCost__c}" id="DeliveryCost__c" />
                                </td>
                                <td class="clsCurrencyTD">
                                    <apex:outputLabel id="deliveryCostCurrency" styleClass="reqDefclsInputLabelTD" value="{!currencyUsed} /" />
                                </td>
                                <td class="clsPrice1TD"><apex:inputfield styleClass="clsRequestDefSelectList"
                                    value="{!reqDefBean.reqDefObj.BMCServiceDesk__CostOption1__c}"
                                    id="CostOption1__c" /><apex:outputLabel value="/" /></td>
                                <td class="clsPrice2TD"><apex:inputfield styleClass="clsRequestDefSelectList"
                                    value="{!reqDefBean.reqDefObj.BMCServiceDesk__CostOption2__c}"
                                    id="CostOption2__c" /></td>
                            </tr>
                        </table>
                        </td>
                    </tr>

                    <tr>
                        <td class="clsInputLabelTD clsInputfixedLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__TurnaroundTime__c.label}" /></td>
                        <td>
                        <table cellpadding="0" cellspacing="0">
                            <tr>
                                <td class="days-label-td" 
                                    title="{!$ObjectType.SRM_RequestDefinition__c.fields.TurnaroundTime__c.inlineHelpText}">
                                <div id="days-ct" /><apex:outputLabel StyleClass="clsLabelHistoryDays" value="{!$Label.bmcservicedesk__IncidentHistoryDays}" />
                                </td>
                                <td class="hours-label-td" 
                                    title="{!$ObjectType.SRM_RequestDefinition__c.fields.TurnaroundTime__c.inlineHelpText}">
                                <div id="hours-ct" /><apex:outputLabel StyleClass="clsBottomPadTD" value="{!$Label.bmcservicedesk__HoursLabel}" />
                                </td>
                            </tr>
                        </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__StartDate__c.label}" />
                        </td>
                        <td class="clsInputTextBoxTD"
                            title="{!$ObjectType.SRM_RequestDefinition__c.fields.StartDate__c.inlineHelpText}">
                        
                            <apex:inputField value="{!reqDefBean.reqDefObj.BMCServiceDesk__StartDate__c}"
                                id="RequestDefinition__c_id_StartDate__c"
                                StyleClass="clsInputTextBox1"/>
                        </td>
                    </tr>
                    <tr>
                        <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__EndDate__c.label}" />
                        </td>
                        <td class="clsInputTextBoxTD"
                            title="{!$ObjectType.SRM_RequestDefinition__c.fields.EndDate__c.inlineHelpText}">
                        
                            <apex:inputField value="{!reqDefBean.reqDefObj.BMCServiceDesk__EndDate__c}"
                                id="RequestDefinition__c_id_EndDate__c"
                                StyleClass="clsInputTextBox1"/>
                        </td>
                    </tr>
                    <tr>
                        <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__Image__c.label}" /></td>
                        <td>
                        <table cellpadding="0" cellspacing="0" width="100%">
                            <tr>
                                <td width="25%" class = "clsBottomPadTD">
                                    <table cellpadding="0" cellspacing="0">
                                        <tr>
                                            <td class="clsImageTD">
                                                <div id="enclosingDiv"  >
                                                    <apex:image value="/servlet/servlet.FileDownload?file={!reqDefBean.reqDefObj.BMCServiceDesk__Image__c}"  id="Image_Id" height="90" width="111px"  />

                                                   <image id="someImage" src="" class="clsImage" onError="ImgError(this)"/>
                                                </div> 
                                                
                                                <script>
                                                
                                                    document.getElementById('someImage').src=document.getElementById('someImage').src;
                                                    if(!'{!JSENCODE(reqDefBean.reqDefObj.Image__c)}')
                                                    document.getElementById('thePage:ReqDefForm:Image_Id').style.display='none';
                                                 </script>
                                            </td>
                                        </tr>
                                    </table>        
                                </td>
                                <td  class = "clsBottomPadTD1">
                                <table cellpadding="0" cellspacing="0" width="100%">
                                    <tr>
                                        <td valign="Top">
                                         <table>
                                         <tr>
                                          <td valign="Top">
                                            <input type="radio" name="selectRadio" id="radioCom" onclick="document.getElementById('radioSF').checked = false;"/>
                                            <apex:outputLabel styleClass="clsInputLabelTD" value="{!$Label.bmcservicedesk__SelectFromComputer}" />
                                          </td>
                                          </tr>
                                          <tr>
                                          <td ><input type="radio" name="selectRadio" id="radioSF" onclick="document.getElementById('radioCom').checked = false;" />
                                            <apex:outputLabel styleClass="clsInputLabelTD" value="{!$Label.bmcservicedesk__SelectFromSalesforce}"/>
                                             </td>
                                             </tr>
                                             <tr>
                                            <td>
                                            
                                            <input class="selectBtnCls" type="button" value="{!$Label.SelectButton}" onclick="openImagePopup();"/>
                                        </td>
                                        </tr>
                                            
                                            </table>
                                            </td>
                                    </tr>
                                    <!--  <tr>  
                                        <td ><input type="radio" id="radioSF" onclick="document.getElementById('radioCom').checked = false;" />
                                            <apex:outputLabel styleClass="clsInputLabelTD" value="Select From Salesforce"/> </td>
                                        
                                    </tr>
                                       <tr>
                                        <td height="35px">
                                        </td>
                                    </tr>   
                                    <tr>
                                        <td>
                                            <input class="selectBtnCls" type="button" value="Select..." onclick="openImagePopup();"/>
                                        </td>   
                                    </tr> -->
                                </table>
                                </td>
                            </tr>
                        </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="clsInputLabelTD clsInputfixedLabelTD">
                            <apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__Status__c.label}" />
                        </td>
                        <td class="clsInputTextBoxTD">
                            <apex:inputfield value="{!reqDefBean.reqDefObj.BMCServiceDesk__Status__c}" id="RequestDefinition_Status" styleClass="clsRequestDefSelectList1" />
                        </td>

                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA clsInputLabelTD clsRequestDefOnlineTD" colspan="2">
                            <apex:inputCheckbox title="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__Online__c.inlineHelpText}" id="RequestDefinition_Online" value="{!reqDefBean.reqDefObj.BMCServiceDesk__Online__c}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__Online__c.label}" /> 
                        </td>
                    </tr>
                     <tr>
                         <td class='clsPanelInputCheckboxTDSA clsInputLabelTD clsApprovalRequiredTD'  colspan="2">
                               <apex:inputcheckbox value="{!reqDefBean.reqDefObj.BMCServiceDesk__ApprovalRequired__c}" id="isApprovalReqd" />
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__ApprovalRequired}"/>
                        </td>
                    </tr>
                </table>
                </div>
                
                <div id='ReqDef_EntitlementTab' class="clsEntitlemenetTab">
                                <table class="clsEntitlementTable">
                                    <tr>
                                        <td class="clsBoldInputLabelTD">
                                            <apex:outputLabel value="{!$Label.bmcservicedesk__AccountEntitlement}"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <apex:selectRadio value="{!reqDefBean.reqDefObj.BMCServiceDesk__AllAccounts__c}" id="allAccount" layout="pageDirection" styleClass="checkLabel" label="{!$Label.bmcservicedesk__AllAccountsEntitlement}" onclick="toggleAccountSelector(this.value);">
                                            <apex:selectOptions value="{!accountOptions}"/>
                                        </apex:selectRadio>                                     
                                    </tr>
                                    
                                    <table class="clsclsAvailableTableAccounts1">
                                        <tr>
                                            <table class="clsAvailableTableAccounts">
                                                <tr>
                                                    <td width="300px" class="clsBoldInputLabelTD">
                                                        <apex:outputLabel value="{!$Label.bmcservicedesk__AvailableAccounts}"/>
                                                    </td>
                                                    <td class="clsBoldInputLabelTD">
                                                        <apex:outputLabel value="{!$Label.bmcservicedesk__SelectedAccounts}"  />
                                                    </td>
                                                </tr>
                                            </table>
                                        </tr>
                                        <tr>
                                            <div id='toolBar' class="clsMarginLeftTD" ></div>
                                        </tr>
                                        <tr>
                                            <div id='accountSelectorDiv' class="clsMarginLeftTD"></div>
                                            <apex:inputHidden id="selectedAccounts" value="{!reqDefBean.selectedAccounts}" />
                                        </tr>
                                    </table>
                                    <table class="clsTable2">
                                        <tr>
                                            <td class="clsBoldInputLabelTD">
                                                <apex:outputLabel value="{!$Label.bmcservicedesk__ProfileEntitlement}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <apex:selectRadio value="{!reqDefBean.allProfiles}" id="allProfile" layout="pageDirection" styleClass="checkLabel" onclick="toggleProfileSelector(this.value);">
                                                <apex:selectOptions value="{!profileOptions}" />
                                            </apex:selectRadio>                                     
                                        </tr>
                                        <tr>
                                            <table class="clsAvailableTableAccounts">
                                                <tr>
                                                    <td width="300px" class="clsBoldInputLabelTD">
                                                        <apex:outputLabel value="{!$Label.bmcservicedesk__AvailableProfile}"/>
                                                    </td>
                                                    <td class="clsBoldInputLabelTD">
                                                        <apex:outputLabel value="{!$Label.bmcservicedesk__SelectedProfile}"  />
                                                    </td>
                                                </tr>
                                            </table>
                                        </tr>
                                        <tr>
                                            <div id='profileSelectorDiv' class="clsMarginLeftTD"></div>
                                            <apex:inputHidden id="selectedProfiles" value="{!reqDefBean.reqDefObj.BMCServiceDesk__Profiles__c}" />
                                        </tr>
                                    </table>                                           
                                    
                                    
                                   
                                </table>
                            </div>
                
                <div id='ReqDef_FulfillmentTab' class="clsFulfillmentTab" >
                    <table width="659" cellpadding="0" cellspacing="0" border="0">
                      <tr>
                        <td></td>
                      </tr>
                    </table>
                    <table class="x-hide-display" cellspacing="0" cellpadding="0" width="100%" border="0" id="inputListDiv">
                         <tr>
                            <td>
                                <table>
                                     <tr>
                                         <td colspan="2" class="clsBoldInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__UserInstructions__c.label}" /></td>
                                     </tr>
                                     <tr>
                                         <td width="100%">
                                             <div class="clsRelativePosition">
                                                 <apex:inputTextarea title="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__UserInstructions__c.inlineHelpText}" id="SRM_RequestDefinition_userInstructions__c" value="{!reqDefBean.userInstructions}" styleClass="clsInputTextArea" tabindex="509"/>
                                             </div>
                                         </td>
                                         <td class="clsInputTextAreaTD" valign="top">
                                             <input type="button" id="inputTxtAreaButton" class="TextboxPopupIcon" style="display:inline" onclick="showTextEditor('{!$Component.ReqDefForm.SRM_RequestDefinition_userInstructions__c}', '{!JSENCODE($ObjectType.SRM_RequestDefinition__c.fields.userInstructions__c.label)}', '32000', '{!JSENCODE($Label.OK)}', '{!JSENCODE($Label.Cancel)}');"/>
                                         </td>
                                     </tr>
                                </table>
                            </td>
                         </tr>
                         <tr height="15px">
                              <td>&nbsp;</td>
                         </tr>
                         <tr>
                            <td>
                                <table>
                                  <tr>
                                        <td class="clsBoldInputLabelTD" colspan="2" >
                                            <apex:outputLabel value="{!$Label.bmcservicedesk__Request_Inputs}" id="QVDescLabel"/>
                                        </td>
                                  </tr>
                                  <tr>
                                        <td><div id="grid"></div></td> 
                                        <td class="clsInputTextAreaTD">
                                            <table>
                                                <tr>
                                                <td>
                                                    <input id="btnUpId" type="button" class="btnArrowUpDisable" onclick="moveSelectedRow(-1)" disabled="disabled"/>
                                                </td>
                                                </tr>
                                                <tr>
                                                <td>
                                                    <input id="btnDownId" type="button" class="btnArrowDownDisable" onclick="moveSelectedRow(1)" disabled="disabled"/>
                                                </td>
                                                </tr>
                                            </table>
                                      </td>
                                  </tr>
                                </table>        
                            </td>
                       </tr>
                    </table>        
                    <table class="x-hide-display" cellspacing="0" cellpadding="0" width="100%" border="0" id="inputMappingDiv" >
                        <tr>
                            <td valign="top" colspan="3">
                                <apex:outputPanel id="mapInstructionPanel" layout="block">
                                    <table>
                                        <tr>
                                            <td style="width:20px;" valign="top">
                                                 <img src="{!$Resource.Themes}/SSDefaultTheme/images/en_US/SS_Information_16.png"/>
                                            </td>
                                            <td class="mapInstrucntionCls" valign="top">
                                                <apex:outputLabel value="{!$Label.bmcservicedesk__FulfillmentMappingInstructions}" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">&nbsp;</td>
                                        </tr>
                                    </table>
                                </apex:outputPanel>         
                            </td>
                        </tr>
                        <tr>
                            <td align="left">
                                <table>
                                    <tr>
                                        <td class="clsBoldInputLabelTD"><apex:outputLabel value="{!$Label.bmcservicedesk__RequestInputSource}" /></td>
                                    </tr>
                                    <tr>
                                        <td><div id="reqInputGrid"></div></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <input id="addMappingBtn" type="button"  class="defaultBtn"  value="{!$Label.Add}" onclick="addFulfillmentMapping()" />
                                        </td>
                                    </tr>
                                </table>
                             </td>
                             <td>&nbsp;</td>
                             <td align="right">
                                <table>
                                    <tr>
                                            <td align="left" class="clsBoldInputLabelTD"><apex:outputLabel value="{!$Label.bmcservicedesk__ProcessVariableTarget}" /> </td>
                                    </tr>
                                    <tr>
                                        <td><div id="processVarGrid"></div></td>
                                    </tr>
                                   <tr>
                                     <td>
                                        <table>
                                            <tr>
                                                <td><img src="{!$Resource.SDEFStyles}/SDEFicons/svt-warning.png" class="clsImageSrcTD"/></td>
                                                <td><apex:outputLabel value="{!$Label.bmcservicedesk__RequiredVariable}" StyleClass="clsPadding5TD"/></td>
                                            </tr>
                                        </table>
                                     </td>
                                    </tr>
                                </table>
                             </td>
                         </tr>
                         <tr>
                             <td  colspan="3" >
                                <div class="div15pxVspacing"></div>
                             </td>
                         </tr>
                         <tr height="15px">
                            <td colspan="3">
                                <div id="mappingGrid"></div>
                            </td>
                         </tr>
                    </table> 
                     <apex:inputhidden value="{!reqDefBean.reqDefObj.BMCServiceDesk__Set_Execution_Order__c}" id="RequestDefinition__c_id_Set_Execution_Order__c"/>
                </div>
                <div id='ReqDef_OptionsTab' class="clsOptionsTab">
                <apex:outputPanel id="OptionsTab">
                <table width="646" cellpadding="0" cellspacing="0" class="clsMarginLeftTD1">
                    <tr>
                        <td height="13" ></td>
                    </tr>
                    <tr>
                        <td height="9" ></td>
                    </tr>
                    
                    <!--  ############ Save & Edit functionality for this commented section is already implemented ################ --> 
                    
                         <tr>
                            <td class="clsBoldInputLabelTD"><apex:outputLabel value="{!$Label.bmcservicedesk__reqDefReviewService}"/></td>
                        </tr>
                        <tr>
                            <td> <apex:outputLabel value="{!$Label.bmcservicedesk__reviewInstruction}"/></td>
                        </tr>
                        <tr> 
                            <td height="6" ></td>
                        </tr>
                      <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefTurnTime" value="{!reqDefBean.turnAround}"/>
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__reqDefTurnaroundTime}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>  
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefPrice" value="{!reqDefBean.price}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__reqDefPrice}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefExptCom" value="{!reqDefBean.dateExpected}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__reqDefExpectedCompletion}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefPhone" value="{!reqDefBean.phone}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__Phone}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefEmail" value="{!reqDefBean.email}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__Email}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefAttachment" value="{!reqDefBean.attachment}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__Attachments}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefInstructions" value="{!reqDefBean.instructions}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__reqDefInstructions}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefServiceCoordinator" value="{!reqDefBean.serviceCoordinator}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__AssignedTo}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="Approvals" value="{!reqDefBean.approvals}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__Approvals}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="11" ></td>
                    </tr>
                    
                      <tr>
                            <td class="clsBoldInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__SRM_RequestDefinition__c.fields.BMCServiceDesk__ProvideInformation__c.label}"/></td>
                        </tr>
                    <tr>
                        <td><apex:outputLabel value="{!$Label.bmcservicedesk__provideInstruction}"/></td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefDateReq" value="{!reqDefBean.dateRequired}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__reqDefDateReq}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="6" ></td>
                    </tr>
                    <tr>
                        <td class="clsPanelInputCheckboxTDSA">
                            <apex:inputCheckbox title="" id="reqDefQuantity" value="{!reqDefBean.quantity}"/> 
                            <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$Label.bmcservicedesk__reqDefQuantity}"/>
                        </td>
                    </tr>
                    <tr>
                        <td height="11" ></td> 
                    </tr>
        </table>    
                </apex:outputPanel>
                
                
                
                </div>
            </tr>
        </table>

        </div>
        
        <apex:outputPanel id="apexMessageErrorPanel" >
         <div id="apexMessageErrorPanelDiv" style="display:none;">
            <apex:messages />
        </div>
     </apex:outputPanel>
     
     <!--  
         Input hidden, contains changed/rearranged ordered string for request inputs
     -->
    <apex:inputHidden value="{!reqDefBean.reqInputOrderStr}" id="reqInputOrder"/>
    
    <apex:actionRegion >
        <apex:actionFunction name="addProcessTemplateAction" action="{!addTemplate}" rerender="processTemplateStore, mappingDataPanel,validationComponent" oncomplete="setProcessData();showError();">
            <apex:param name="templateId" value="" assignTo="{!reqDefBean.newTemplateId}"/>
        </apex:actionFunction>
    </apex:actionRegion>
    <apex:actionRegion >
        <apex:actionFunction name="removeProcessAction" action="{!removeProcess}" rerender="processTemplateStore, mappingDataPanel, inputMappingStore, validationComponent" oncomplete="setProcessData();setInputMappingData();showError();waitMsg.hide();">
            <apex:param name="templateId" value="" assignTo="{!reqDefBean.delTemplateId}"/>
        </apex:actionFunction>
    </apex:actionRegion>
    <apex:actionRegion >
        <apex:actionFunction name="removeRequestInputAction" action="{!removeRequestInput}" rerender="requestInputStore, mappingDataPanel, inputMappingStore, validationComponent" oncomplete="setInputData();setInputMappingData();showError();waitMsg.hide();">
            <apex:param name="reqInputId" value="" assignTo="{!reqDefBean.requestInputId}"/>
        </apex:actionFunction>
    </apex:actionRegion>
    <apex:actionRegion >
        <apex:actionFunction name="updateInputDataAction" action="{!resetInputData}" rerender="requestInputStore, mappingDataPanel, validationComponent" oncomplete="setInputData();showError();waitMsg.hide();"/>
    </apex:actionRegion>
    <apex:actionRegion >
        <apex:actionFunction name="addMappingAction" action="{!addInputMapping}" rerender="inputMappingStore, processVarStore, validationComponent" oncomplete="setInputMappingData();setProcessVarData();showError();waitMsg.hide();">
            <apex:param name="mapProcessId" value="" assignTo="{!reqDefBean.mapProcessId}"/>
            <apex:param name="mapReqInputIds" value="" assignTo="{!reqDefBean.mapReqInputIds}"/>
            <apex:param name="mapProcessVar" value="" assignTo="{!reqDefBean.mapProcessVarId}"/>
        </apex:actionFunction>
    </apex:actionRegion>
    <apex:actionRegion >
        <apex:actionFunction name="removeInputMappingAction" action="{!removeInputMapping}"  rerender="inputMappingStore, processVarStore, validationComponent" oncomplete="setInputMappingData();setProcessVarData();showError();waitMsg.hide();">
            <apex:param name="mappingIndex" value="" assignTo="{!reqDefBean.mappingIndex}"/>
        </apex:actionFunction>
    </apex:actionRegion>
    <apex:actionRegion >
        <apex:actionFunction name="updateProcessVarAction" action="{!resetProcessVarData}" rerender="processVarStore" oncomplete="setProcessVarData();setInputMappingData();waitMsg.hide();">
            <apex:param name="processVarTemplateId" value="" assignTo="{!reqDefBean.processVarTemplateId}"/>
        </apex:actionFunction>
    </apex:actionRegion>
    </apex:form>
    <apex:outputPanel id="afterSavePanel">
        <script>
			var recordID='{!reqDefBean.reqDefObj.Id}';
      errormsg = '{!JSENCODE(reqDefBean.messageString)}';       
      targetInDays= '{!reqDefbean.targetInDays}';
      targetInHours= '{!reqDefbean.targetInHours}';
  
      newTitle = '{!JSINHTMLENCODE(reqDefBean.reqDefObj.serviceRequestTitle__c)}';      
      reDefId= '{!reqDefBean.reqDefObj.id}';
        function callCopyPage(){
            window.parent.addTab("RequestDefPage?copyId=" + reDefId,reqDefWindowHeader,reqDefWindowHeader);
        }
      prevProcessTemplateId = '{!reqDefBean.prevProcessTemplateId}';
      deletedProcessId = '{!deletedId}';
      
      function handleSave(){
            window.parent.handleSave(getWID(), reDefId);
      }
      </script>

     </apex:outputPanel>
     
     <apex:outputPanel id="EntitlementScript">
        <script>
            
            profileRightStoreData = [{!reqDefBean.selectedProfiles}];
            profileLeftStoreData = [{!reqDefBean.unselectedProfiles}];
            
            accRightStoreData = [{!reqDefBean.selectedAccEnt}];
            accLeftStoreData = [{!reqDefBean.unSelectedAccounts}];            
            
        function callToggleAccountSelector() {
            toggleAccountSelector('{!reqDefBean.reqDefObj.allAccounts__c}');        
        }
        function callToggleProfileSelector() {
            toggleProfileSelector('{!reqDefBean.allProfiles}');
        }
        function getPreFirstBtn(){
            var preFirstBtn = !{!IF(paginator.hasPrevious,'true','false')};                    
            return preFirstBtn;
        }
        function getNextLastBtn(){
            var nextLastBtn = !{!IF(paginator.hasNext,'true','false')};          
            return nextLastBtn;
        }
        </script>
     </apex:outputPanel>
     
     <script>
        var endtime1 = '{!endtime}';
        var etestdate = new Date();
        var etesttime = etestdate.getTime();
        
        servertime1 = (endtime1 - stime);
        
        data +=servertime1;
        data += '<br>';
        
            //time to calculate page rendertime 
            var pageloaddate = new Date();
            var renderingstartitme = pageloaddate.getTime();
     </script>
     
     <script>
     
           var disabled = false; 

           if(reDefId == ''){
                 disabled = true ;
                 document.getElementById('ReqDef_Fulfillment').disabled = true;
                 document.getElementById('ReqDef_Fulfillment').style.color='#808080';
           }
           function enablebtn(){
              if(errormsg == labelSavedSuccessfully && disabled == true){
                  document.getElementById('ReqDef_Fulfillment').disabled = false ;
                  document.getElementById('ReqDef_Fulfillment').style.color = '#004376';
              }
           }
           checkPermissions();
           function getExecOrderEle(){
           	return document.getElementById('{!$Component.ReqDefForm.RequestDefinition__c_id_Set_Execution_Order__c}');
           }		   
           var description_RichText = document.getElementById('{!$Component.ReqDefForm.ReqDef_Description_RichText}').value;;           
           function setDescriptionFields(){              
              document.getElementById('{!$Component.ReqDefForm.ReqDef_Description_RichText}').value = description_RichText ;
           }
     </script>
</apex:page>